#!/bin/sh

set -e

BUILD_DIR=${1:-}
CACHE_DIR=${2:-}
ENV_DIR=${3:-}

# Config Globals
LANG=en-US
PLATFORM=linux64

APT_CACHE_DIR="$CACHE_DIR/apt/cache"
APT_STATE_DIR="$CACHE_DIR/apt/state"
APT_OPTIONS="-o debug::nolocking=true -o dir::cache=$APT_CACHE_DIR -o dir::state=$APT_STATE_DIR"

mkdir -p $CACHE_DIR
mkdir -p "$APT_CACHE_DIR/archives/partial"
mkdir -p "$APT_STATE_DIR/lists/partial"

#ARCHIVE_NAME=firefox
#FILE_NAME=${ARCHIVE_NAME}-latest.tar.bz2
#BUILDPACK_FIREFOX_PACKAGE="https://download.mozilla.org/?product=firefox-latest-SSL&os=linux64&lang=en-US"
#
#if ! [ -e $CACHE_DIR/$FILE_NAME ]; then
#  echo "-----> Fetching Firefox package from ${BUILDPACK_FIREFOX_PACKAGE}"
#  curl -s $BUILDPACK_FIREFOX_PACKAGE -L -o $CACHE_DIR/$FILE_NAME
#fi
#
#echo "-----> Extracting Firefox binaries to ${BUILD_DIR}/vendor/${ARCHIVE_NAME}"
#mkdir -p $CACHE_DIR/$ARCHIVE_NAME
#mkdir -p $BUILD_DIR/vendor
#tar jxf $CACHE_DIR/$FILE_NAME -C $CACHE_DIR
#mv $CACHE_DIR/$ARCHIVE_NAME $BUILD_DIR/vendor/

echo "-----> Installing needed packages"
apt-get $APT_OPTIONS update
apt-get $APT_OPTIONS -y -d install --reinstall gdebi xserver-xorg-core libgl1-mesa-dri xvfb libglide3 unzip firefox
# wget https://cloud.gastecnologia.com.br/gas/diagnostico/warsaw_setup_64.deb -O /tmp/warsaw.deb
# gdebi --non-interactive --option=$APT_OPTIONS /tmp/warsaw.deb
